package com.eateryfinderwebapp.eateryfinderwebapp.webscraper;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import com.eateryfinderwebapp.eateryfinderwebapp.models.Location;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;

public class WebScraper {
//Connect to database and go through every single osm_id and add longitude and latitude to them

    List<Location> locations;

    public WebScraper(){
        locations = new ArrayList<>();
    }

    static String [] nodes = {
            "8188528781", "459670881", "8121684194", "3341289753", "4846704245", "411009859",
            "6802029812", "411008299", "411008532", "441057694", "459670767", "1615830879", "1850511008", "1851476126",
            "2054895230", "2298054794", "2539581007", "2539581507", "3101725379", "3101726037", "3103985004",
            "3341289752", "3341289786", "3341289788", "3341289790", "3506696093", "3663767991", "3663767992",
            "310348048", "470916907" , "918590533", "933634409", "1355336585", "1381654588", "1475404531", "1822907697",
            "1866179709", "1870054369", "2004962771", "2472332550", "2858315264", "2883877900", "4355253301",
            "3304519276", "3484101195", "5289706560", "3623547525", "5204164823", "4187276689", "4190893589",
            "4355253301", "4394802591", "4456514081", "4573205008", "4573205010", "4594432344", "4650540393",
            "4734473401", "5041735621", "5131817487", "3663791822", "3494577049", "5292123332", "5292130849",
            "5299947547", "5331095878", "5333318377", "5431407636", "5660202454", "5687563887", "5782900754",
            "5869018606", "6054048692", "6164755128", "6164755129", "6604781586", "6632801985", "6811622585",
            "6814231699", "6814236601", "6814236605", "6814246713", "6814246719", "6814247285", "6815931187",
            "7508938085", "7528237388",
            "309894643", "411006922", "429175192", "445422613", "459668143", "459668914",
            "459669063", "481098096", "577538782", "600905655", "696669231", "908273433", "1132688809", "1371716593",
            "1372568001", "1377184494", "1378130151", "1378228324", "1378228333", "1380378665", "1380378702",
            "1475328750", "1475388232", "1535266560", "1577483516", "1577485951", "1676857177", "1747649203",
            "1748017584", "1751563134", "1752178268", "1752186795", "1770866402", "1848409293", "1850489869",
            "1850521527", "1857486052", "1867176020", "1868812117", "1868812169", "1868933572", "1985948203",
            "1999633538", "2105387352", "2159535851", "2294320125", "2322886873", "2324290153", "2333163643",
            "2334423406", "2411329687", "2580192144", "2818872887", "2883877896", "3020876346", "3101726040",
            "3341289789", "3484100384", "4436534289", "3505013993", "3506695093", "3536179577", "3599403566",
            "3648714485", "3707090923", "3830455732", "3832475135", "3832475147", "3909066219", "3932033588",
            "3951819586", "4004645106", "4016557277", "4101107990", "4126731965", "4149490289", "4195733217",
            "4239053639", "4253210327", "4275843195", "4302211290", "4318400296", "4327921318", "4346542839",
            "4355675606", "4386326331", "4406532855", "4407370494", "5548809221", "3505013893", "4436534489",
            "4459578969", "4471884330", "4481662566", "4491144570", "32674402", "4552084306", "4650542892",
            "4650625589", "4720703993", "496423190", "4920962547", "4976334922", "4990142138", "5019758021",
            "5033108253", "5064700321", "5072397092", "5074216083", "5131832941", "5160613722", "5184727125",
            "5224224121", "5246219203", "5268700370", "176448667", "5292130848", "5467884712", "5548809221",
            "5561692079", "5624670966", "5624682355", "379896010", "5624682357", "5624682358", "5626432520",
            "5626433457", "5626433502", "5692608680", "5770427174", "5789449053", "5813417254", "5830234866",
            "5840484087", "6032865286", "6054050099", "6102488864", "6268687385", "6275187295", "6278471769",
            "6386335236", "6405264185", "6586691822", "6781335887", "6788977446", "6796436088", "6814231688",
            "6814231700", "6814231702", "6814231793", "6814236587", "6814236621", "6814245589", "6814246691",
            "6814246724", "6815434691", "6815454785", "6815918386", "6815931392", "6821158588", "4149490289",
            "6827032731", "6827032733", "6827076186", "6830542186", "7001354685", "7027229685", "7093171485",
            "7130929832",
            "309875534", "2624195137", "1355330790",
            "1747462360", "1935491365", "2695392360", "3427388702", "3427391618", "5559033546", "4594432343",
            "4594432346", "4839149455", "5093444115", "5260415957", "5289611966", "4126731457", "6815931485"
    };

    public List<Location> getLocations(){
        try {

            // Here we create a document object and use JSoup to fetch the website
            for (int i=0; i<nodes.length; i++){
                String node = nodes[i];
                Document doc = Jsoup.connect("https://www.openstreetmap.org/node/"+node).get();

                // With the document fetched, we use JSoup's title() method to fetch the title

                String fullName = doc.getElementsByTag("bdi").text();
                String parts[] = fullName.split("\\s+");
                String name = "";
                String osm_id = "";
                for (int j=0; j<parts.length; j++){
                    if (j<parts.length - 2){
                        name+=parts[j] + " ";
                    }
                    else if(j<parts.length - 1)
                    {
                        name+=parts[j];
                    }
                    else {
                        osm_id=parts[j];
                    }
                }

                double latitude = Double.parseDouble(doc.getElementsByClass("latitude").text());
                double longitude = Double.parseDouble(doc.getElementsByClass("longitude").text());
                Location location = new Location( Double.parseDouble(osm_id), name, latitude, longitude);
                locations.add(location);
            }


        } catch (IOException e) {
            e.printStackTrace();
        }
        return locations;
    }

}
